<div class="chat-container">
  <!-- Sidebar -->
  <div class="chat-sidebar">
    <div class="sidebar-header">
      <h2>ðŸ’¬ Conversations</h2>
      <button class="btn-new-chat" (click)="createNewConversation()">
        + New Chat
      </button>
    </div>

    <div class="conversation-list">
      @for (conv of conversations; track conv.id) {
        <div
          class="conversation-item"
          [class.active]="currentConversation?.id === conv.id"
          (click)="loadConversation(conv.id)"
        >
          <div class="conv-icon">ðŸ’¬</div>
          <div class="conv-content">
            <div class="conv-title">{{ conv.title }}</div>
            <div class="conv-meta">{{ conv.message_count }} messages</div>
          </div>
        </div>
      }

      @if (conversations.length === 0) {
        <div class="empty-state">
          <p>No conversations yet. Start chatting!</p>
        </div>
      }
    </div>
  </div>

  <!-- Chat Area -->
  <div class="chat-main">
    @if (currentConversation) {
      <div class="chat-header">
        <h2>{{ currentConversation.title }}</h2>
        @if (currentConversation.topic) {
          <p>{{ currentConversation.topic }}</p>
        }
      </div>
    }

    <div class="chat-messages" #messagesContainer>
      <div class="messages-wrapper">
        @if (messages.length === 0) {
          <div class="welcome-message">
            <div class="welcome-icon">ðŸ¤–</div>
            <h2>Ask me anything...</h2>
            <p>I'm here to help you learn and answer your questions!</p>
          </div>
        }

        @for (msg of messages; track msg.id) {
          <div
            class="message"
            [class.user-message]="msg.role === 'user'"
            [class.assistant-message]="msg.role === 'assistant'"
          >
            <div class="message-avatar">
              @if (msg.role === 'user') {
                <span>ðŸ‘¤</span>
              } @else {
                <span>ðŸ¤–</span>
              }
            </div>
            <div class="message-content">
              <div class="message-text">{{ msg.content }}</div>
              <div class="message-time">{{ formatTime(msg.created_at) }}</div>
            </div>
          </div>
        }

        @if (sendingMessage) {
          <div class="message assistant-message">
            <div class="message-avatar">ðŸ¤–</div>
            <div class="message-content">
              <div class="message-text typing">
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <div class="chat-input-area">
      <form (ngSubmit)="sendMessage()" class="chat-input-form">
        <input
          type="text"
          [(ngModel)]="messageText"
          name="message"
          placeholder="Ask me anything..."
          [disabled]="sendingMessage || !currentConversation"
          class="chat-input"
        />
        <button
          type="submit"
          class="btn-send"
          [disabled]="!messageText.trim() || sendingMessage || !currentConversation"
        >
          @if (!sendingMessage) {
            <span>â†‘</span>
          } @else {
            <span class="spinner-small"></span>
          }
        </button>
      </form>
    </div>
  </div>
</div>
